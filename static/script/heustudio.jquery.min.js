/*! heustudio.jquery.min.js 1.0 | (c) 2014 */
$(document).ready(function(){
	
	var count = 0;//记录点击次数

	function resetHeight(){
		$(".rightbar ").css("height",$(".content ").css("height"));
		$(".sidebar ").css("height",$(".content ").css("height"));
		$(".bar ").css("min-height",$(".dinfo ").css("height"));
	}
	resetHeight();
	//防震设置
	$("#ld").click(function(){
		if($('input:radio[name="level"]:checked').val() == 2){
			$("#lds").removeClass("disabled").attr("disabled",false);
		}
		else{
			$("#lds").addClass("disabled").attr("disabled",true);
		}
	});
	
	$(".addline").mouseover(function(){ 
		$(this).next(".linetip").show();
	});
	$(".addline").mouseout(function(){ 
		$(this).next(".linetip").hide();
	});
	
	//添加一行备注
	$(".addline").click(function(){ 
		count++;
		var idname = "index" + new Date().getTime();
		var data = $(this).parent(".item").attr("data");
		var parendata = $(this).parents(".dlisf").attr("data");
		var biaoshi = data+parendata+count;
		var htmlt = "<div id=\""+biaoshi+"\"></div>"
		$(this).parents("#dlisf"+parendata).append(htmlt);
		$("#"+biaoshi).append($("#clone .item").clone(true));//克隆
		//radiobutton
		// $("#"+biaoshi+" .item" ).attr("data",count);
		$("#"+biaoshi+" .item #quantity .cinfoi").attr("name","m"+data+"nn"+count);
		$("#"+biaoshi+" .item #degree .cinfoi").attr("name","m"+data+"nl"+count);
		$("#"+biaoshi+" .item .plus").attr("data","m"+data+count);
		$("#"+biaoshi+" .item .minus").attr("data","m"+data+count);
		$("#"+biaoshi+" .item .ts").attr("id","ts"+"m"+data+count);
	
		$("#iii #"+data+"i").append("<p class=\"i "+idname+"i addedi\">『<span class=\"nl\"></span>』 - 『备注：<span class=\"bz\"></span>』 - 『<span class=\"ns\">0</span>』</p>");
	});
	
	$(".minline").mouseover(function(){ 
		$(this).next(".linetip").show();
	});
	$(".minline").mouseout(function(){ 
		$(this).next(".linetip").hide();
	});
	
	$(".minline").click(function(){
		$(this).parents(".item").remove();
		var data = $(this).parent(".item").attr("data");
		$("#iii #"+data+"i p").last().remove();
	});
	
	$(".cinfoi").on("change",function() {
		var o = $(this).parents(".dlisf").prev(".title");
		var addspan = $("#"+o.text());
		if(addspan.children().length==0)
		{
			addspan.append("<span>√</span>");
		}
		// var ids = $(this).parent("fieldset").parent("div").attr("id");//zzl
		// var iddata = $(this).parent("fieldset").parent("div").attr("data");
		// var slo = $("#"+ids).children("fieldset").children("input[name='"+ids+"nn"+iddata+"']:checked");
		// var sl = (slo.size() == 0)?"":slo.val();//""
		// var cdo = $("#"+ids).children("fieldset").children("input[name='"+ids+"nl"+iddata+"']:checked");
		// alert(cdo.size());
		// if(cdo.size() == 0){
		// 	$("#"+ids).children("fieldset").children("input[value='轻微']").attr("checked","checked");
		// 	var cd = "轻微";
		// }
		// else{
		// 	var cd = cdo.val()
		// }
		// $("#iii ."+ids+"i .nl").html(sl + cd);
		// $("." + $(this).parent("fieldset").parent("div").attr("data") + "s").show() ;
	});
	
	$(".dlisf div .tb").on("keyup",function(){

		if($(this).val() != ""){
			

			$(this).next("div").children(".ts").attr("disabled",false);
			$(this).next("div").children(".pl5min").removeAttr("disabled");			
		}else{
			$(this).next("div").children(".ts").val(0).attr("disabled",true);
			//$("#" + $(this).parent("div").parent("div").attr("data") + "i ." + $(this).parent("div").parent("div").attr("id") + "i .ns").html("0");
			$(this).next("div").children(".pl5min").attr("disabled","disabled");
		}
	});
	
	$(".dlisf div .tb").on("blur",function(){
		var v = $(this).val();
		var ids = $(this).parent("div").parent("div").attr("id");
		$("#iii ."+ids+"i .bz").html(v);
		$("." + $(this).parent("div").parent("div").attr("data") + "s").show() ;
	});
	
	$(".dlisf div .ts").on("blur",function(){
		var v = $(this).val();
		var ids = $(this).parent("div").parent("div").parent("div").attr("id");
		$("#iii ."+ids+"i .ns").html(v);
		$("." + $(this).parent("div").parent("div").parent("div").attr("data") + "s").show() ;
	});
	
	$("#online").mouseover(function(){
		$(".qq").show();
		$(".oimg").css("border-color","#fff");
	});
	$("#online").mouseout(function(){
		$(".qq").hide();
		$(".oimg").css("border-color","#ddd");
	});
	
	$("#image").mouseover(function(){
		$(".image").show();
		$(".oimg").css("border-color","#fff");
	});
	$("#image").mouseout(function(){
		if($(this).children("div").children(".fixedbar").children(".tdico").attr("data") == "hide"){
			$(".image").hide();
			$(".oimg").css("border-color","#ddd");
			$(this).children(".oimg").removeClass("hover");
			$(this).parent(".rightbar").removeClass("hopacity");
		}
		else{
			$(this).children(".oimg").addClass("hover");
			$(this).parent(".rightbar").addClass("hopacity");
		}
	});
	
	$(".fixedbar .tdico").click(function(){
		if($(this).attr("data") == "hide"){
			$(this).attr("data","show");
			$(this).css("background-position","center left");
		}
		else{
			$(this).attr("data","hide");
			$(this).css("background-position","center right");
		}
		
	});
	
	$("#video").mouseover(function(){
		$(".video").show();
		$(".oimg").css("border-color","#fff");
	});
	$("#video").mouseout(function(){
		if($(this).children("div").children(".fixedbar").children(".tdico").attr("data") == "hide"){
			$(".video").hide();
			$(".oimg").css("border-color","#ddd");
			$(this).children(".oimg").removeClass("hover");
			$(this).parent(".rightbar").removeClass("hopacity");
		}
		else{
			$(this).children(".oimg").addClass("hover");
			$(this).parent(".rightbar").addClass("hopacity");
		}
	});
	
	
	$(".changeitem li").click(function(){
		$(".changeitem li").removeClass("hover");
		$(this).addClass("hover");
		
		$(this).parent("ul").next("div").children(".tt").html($(this).text());
		$(this).parent("ul").next("div").children("img").attr("src",$(this).attr("data"));
		$(this).parent("ul").next("div").children(".tde").html($(this).attr("desc"));
	});
	/*
	$("#online").css("top",($(window).height()/2)+$(document).scrollTop()-40);
	$(document).scroll(function(){
		$("#online").css("top",(($(window).height() - 95)/2)+$(document).scrollTop()-40);
	})*/
	
	$("#totop").click(function(){
		$(document).scrollTop(0);
	});
	
	function hidehelp(){
		$(".tipinfo").hide();
	}
	var helptip;
	$(".helptip").mouseover(function(){
		 $(".tipinfo").show();  
	});
	
	$(".helptip").mouseout(function(){
		 helptip = setTimeout(hidehelp, 1000); 
	});
	
	$(".htip").mouseover(function(){
		helptip = window.clearTimeout(helptip); 
	});
	
	$(".htip").mouseleave(function(){
		 helptip = setTimeout(hidehelp, 1000);
	});
	
	$("#tipbtn").mouseover(function(){
		$(".btntipinfo").show();
	});
	
	$("#tipbtn").mouseout(function(){
		$(".btntipinfo").hide();
	});
	
	$(".setinput").change(function(){
		$("#" + $(this).attr("data")).val($(this).children('option:selected').val());
	});
	
	$(".plus").on("click",function(){
		if($(this).parent("div").attr("disabled") == "disabled") return;
		var o = $("#ts" + $(this).attr("data"));
		o.focus();
		var reg =  /^\d+$/;
		var num = o.val();
		(reg.test(num) && num >= 0) ? o.val(num * 1 + 1) : o.val(0);
		o.blur();
	});
	
	$(".minus").on("click",function(){
		if($(this).parent("div").attr("disabled") == "disabled") return;
		var o = $("#ts" + $(this).attr("data"));
		o.focus();
		var reg =  /^\d+$/;
		var num = o.val();
		(reg.test(num) && num >= 1) ? o.val(--num) : o.val(0);
		o.blur();
	});
	
	$(".body .func").click(function(){
		$(".body .func").removeClass("hover");
		$(this).addClass("hover");
		
		$(".body .cfunc").hide();
		$("#" + $(this).attr("data")).show();
		// 在这块改变一个值
		// alert($(this).attr("data"));
		var s = $(this).attr("data");
		$("#note").val(s);
		// alert($("#note").attr("value"));
	});
	
	$(".wzs").click(function(i){
		$("#" + $(this).attr("data")).siblings(".linehtml").remove();
		$("#" + $(this).attr("data") + "i .addedi").remove();
		
		$("#" + $(this).attr("data") + " input[type = 'radio']").each(function(){
			$(this)	.attr("checked",false);
		})
		$("#" + $(this).attr("data") + " input[class = 'tb']").each(function(){
			$(this).attr("value","");
		})
		$("#" + $(this).attr("data") + " input[class = 'ts n']").each(function(){
			$(this).attr("value","0");
		})
		$("#" + $(this).attr("data") + "i .nl").html("");
		$("#" + $(this).attr("data") + "i .bz").html("");
		$("#" + $(this).attr("data") + "i .ns").html("0");
		
	});
	
	$(".body > .sidebar > li").click(function(){
		if($(this).children("div").children("a").attr("href") != ""){window.location = $(this).children("div").children("a").attr("href");}
	});	
	
	$(".banner > .header .menu li").click(function(){
		if($(this).children("a").attr("href") != ""){window.location = $(this).children("a").attr("href");}
	});	
	
	$("#infolistbg input[name = 'infolist']").click(function(){
		$("#infolistbg tr").removeClass("tabletrtdcolor");
		$(this).parents("tr").addClass("tabletrtdcolor");
	});
	
	$("#happened input[name='ph']").click(function(){
		var n = $('#happened input:radio[name="ph"]:checked').val() * 1;
		$("#ps input[name='ps']").each(function(){
			var t = $(this).val() * 1;
			if((t >= n) && (t != 0)){
				$(this).attr("disabled","disabled");
				$(this).parent("span").css("color","#ccc");
			}
			else{
				$(this).attr("disabled",false);
				$(this).parent("span").css("color","#333");
			}
		});
		
		$("#pb input[name='pb']").each(function(){
			var t = $(this).val() * 1;
			if((t < n) && (t != 0)){
				$(this).attr("disabled","disabled");
				$(this).parent("span").css("color","#ccc");
			}
			else{
				$(this).attr("disabled",false);
				$(this).parent("span").css("color","#333");
			}
		});
	});
	
	$(".addsearch").click(function(){
		var htmlt = "<div class=\"left search adds\"><select class=\"select relation\"><option>并且</option><option>或者</option><option>不含</option></select><select class=\"select\"><option>行政区编码</option><option>地震事件</option><option>建筑物编号</option><option>安全类别</option><option>震损指数</option><option>建筑物名称</option><option>房主</option><option>建成年份</option><option>抗震设防状况</option><option>抗震设防烈度</option><option>既发地震烈度</option><option>鉴定日期</option><option>建筑年份</option><option>中心经度</option><option>中心纬度</option><option>建筑面积</option><option>主体层数</option><option>用途</option><option>鉴定人</option><option>鉴定人员职称</option><option>鉴定单位</option><option>结构类型</option><option>破坏等级</option></select><input type=\"text\" class=\"text\" /><select class=\"select\"><option>精确</option><option>模糊</option></select><input type=\"submit\" class=\"btn\" value=\"查询\" /></div>";
		if($(this).parents(".titlebar").children(".adds").size()< 5){
			$(this).parents(".titlebar").children(".search").each(function(){
				$(this).children("input[class='btn']").remove();
			});
			$(this).parents(".titlebar").children(".search").last().after(htmlt);
		}
	});
	
	$(".minsearch").click(function(){
		$(this).parents(".titlebar").children(".adds").last().prev(".search").append("<input type=\"submit\" class=\"btn\" value=\"查询\" /></div>");
		$(this).parents(".titlebar").children(".adds").last().remove();
	});
	
	$(".changeformatjw").click(function(){
		$(".jwitem").hide();
		$("#"+$(this).attr("data")).show();
	});
	$(".jzwlisttable .bgcbox").click(function(){
		$(".jzwlisttable tr").removeClass("tabletrtdcolor");
		$(".jzwlisttable input:checkbox[class='bgcbox']:checked").each(function(){
			$(this).parent("td").parent("tr").addClass("tabletrtdcolor");
		});
	});
	
	$(".sbtn").mouseover(function(){
		$(this).next(".sbtns").css("z-index","2");
		$(this).prev(".selectskin").css("z-index","-2");
	});
	
	$(".sbtns").mouseleave(function(){
		$(this).css("z-index","-2");
		$(this).prev(".sbtn").prev(".selectskin").css("z-index","2");
	});
	
	$(".sclazinfoimg img").click(function(){
		$("#bpreview img").attr("src",$(this).attr("src"));
		$("#bpreview").css("top",($(window).height()/2)+$(document).scrollTop()-175).css("left",($(window).width()/2)-250).show();
	});
	$("#bpreview .close").click(function(){ $("#bpreview").hide();})
	
	$("#bgcbox").click(function(){
		if($(this).attr("checked") == "checked"){
			$(".bgcbox").attr("checked","checked");
			$(".jzwlisttable tr").addClass("tabletrtdcolor");
		}
		else{
			$(".bgcbox").attr("checked",false);
			$(".jzwlisttable tr").removeClass("tabletrtdcolor");
		}
	});
	
	function in_array(searchv,array){
		for(var i in array){
			if(array[i]==searchv){
				return i;
			}
		}
		return -1;
	}
	
	$(".uinfo .inptxt").blur(function(){
		var o =$(this);
		
		var arr = ["userid", "username", "pass", "rpass", "code", "realname", "idnum", "major", "depart","title", "address","zipcode", "phone", "email"];
		var t = o.attr("data");
		var v = o.val();
		
		var tipinfo = "";
		switch(in_array(t,arr)){
			case "-1":
				return;
				break;
			case "0":
			    if(v==""){
			    	tipinfo="用户ID不能为空！";
			    }
			    else if(v.length>12){
			    	tipinfo="用户ID必须是8-12位！";
			    }
			    else if(v.length<8){
			    	tipinfo="用户ID必须是8-12位！";
			    }
			    break;
			case "1":
				var reg =  /^[a-zA-Z_]{1}[0-9a-zA-Z_]{1,}$/;
				if(!reg.test(v)){
					tipinfo = "用户名必须由字母、数字或\"_\"组成,且首位不能是数字！";
				}
				else if(v.length < 6){
					tipinfo = "用户名长度不能小于6！";
				}
				else if(v.length > 30){
					tipinfo = "用户名长度不能大于30！";
				}
				break;
			case "2":
				if(v.length < 6){
					tipinfo = "密码长度不能小于6！";
				}
				break;
			case "3":
				if(v != $("#password").val()){
					tipinfo = "确认密码与密码不一致！";
				}
				break;
			case "4":
				if(v.trim() == ""){
					tipinfo = "验证码不能为空！";
				}
				break;
			case "5":
			    if(v.length < 4){
			    	tipinfo="真实姓名长度不能小于4，请填写真是姓名！";
			    }
			    else if(v.length>30){
			    	tipinfo="姓名太长，请填写真是姓名！";
			    }
			    break;
			case "6":
			    var reg=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
			    if(!reg.test(v)){
			    	tipinfo="注意身份证号格式，请填写正确的身份证号！";
			    }
			    break;
			case "7":
			    if(v==""){
			    	tipinfo="请填写专业";
			    }
			    break;
			case "8":
			    if(v==""){
			    	tipinfo="请填写单位";
			    }
			    break;
			case "9":
			    if(v==""){
			    	tipinfo="请填写职称";
			    }
			    break;
			case "10":
			    if(v==""){
			    	tipinfo="请填写联系地址";
			    }
			    break;
			case "11":
			    var reg=/^\d{6}$/
			    if(!reg.test(v)){
			     	tipinfo="邮政编码是6位数字！";
			     }
			    break;
			case "12":
			    var isMobile=/^(?:13\d|15\d|18\d)\d{5}(\d{3}|\*{3})$/;
			    var isPhone=/^((0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/;
			    if(!isMobile.test(v) && !isPhone.test(v)){
			    	tipinfo="请正确填写电话号码，例如:13415764179或0321-4816048";
			    } 
			    break;
			case "13":
			    var reg=/^([0-9a-zA-Z]+[-|\\.]?)+[0-9a-zA-Z]@([0-9a-zA-Z]+(-[0-9a-zA-Z])+)?\.+[0-9a-zA-Z]{2,}$/;
			    if(!reg.test(v)){
			    	tipinfo="请输入正确的邮箱！";
			    }
			    break;
		}
		if(tipinfo != ""){
			o.css("border-color","#f00");
			o.parent("p").next(".wrongtip").html(tipinfo).show();
		}
		else{
			o.css("border-color","#cfcdc7");
			o.parent("p").next(".wrongtip").hide();
		}
	});
	
	$(".reg_btn").click(function(){
		var reg =  /^[a-zA-Z_]{1}[0-9a-zA-Z_]{1,}$/;
		if((reg.test($("#username").val())) && ($("#username").val().length > 6) && ($("#userid").val()!="") && ($("#username").val().length < 30) && ($("#password").val().length > 6) && ($("#rpassword").val().length > 6) && ($("#password").val() == $("#rpassword").val()) && ($("#agreement").attr("checked") == "checked")) {
			
			window.location = "reg_step2"+$("input[name='clazz']:checked").val()+".html";
		}
		else{
			alert("请按规则填写内容！");
			return; 
		}
	});

	
	$(".compl_btn").click(function(){
		var reg=/^w+((-w+)|(.w+))*@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+)*.[A-Za-z0-9]+$/;
		if(($("#realname").val().length>4) && ($("#realname").val().length<30) && ($("#idnum").length=18) && ($("#major").val()!="") && ($("#depart").val()!="")&&(reg.test($("#email").val()))){
			window.location = "reg_step3.html";
		}
		else {
			alert("规则错误，请慎重填写！");
			return;
		}
	});
	
	$(".login_email_btn").click(function(){
		window.open("http://mail.126.com/");
	});
	
	$(".wyx input[type='checkbox']").click(function(){
		if($(this).attr("checked") == "checked" && $(this).val() == "0"){
			$(this).parent("span").parent(".wyx").children("span").children("input[type='checkbox']").attr("checked",false);
			$(this).attr("checked","checked");
		}
		else if($(this).val() != "0"){
			$(this).parent("span").parent(".wyx").children("span").children(".ling").attr("checked",false);
		}
	});
	
	$("#ps input[name='ps']").click(function(){
		$("#pb input[value='0']").attr("checked","checked");
	});
	
	$("#pb input[name='pb']").click(function(){
		$("#ps input[value='0']").attr("checked","checked");
	});

	$(".localmark").click(function(){
		var o = $(this).prevAll(".h31");
		var right = $(".locationcontentmark");
		for(var i = 0;i<right.length;i++)
		{
			if(right[i].id == o.text())
				$("#"+right[i].id).css("display","block");
			else
				$("#"+right[i].id).css("display","none");
		}
	});


});

